var _jData, filterId, _jData, htmlStr = "", topNodeIco = "fa-solid fa-users fa-lg", _baseUrl = "";var Lineage = (function () {var _cont, _body, _tree, _tb;function Lineage(p) {this._params = p;var _loader = document.createElement("div");_loader.setAttribute("class", "overlay");_loader.innerHTML = '<div class="overlay__inner"><div class="overlay__content"><span class="loader"></span></div></div>';document.body.appendChild(_loader);if ( typeof this._params.data === "undefined" || typeof this._params.data === null || typeof this._params.data == "" ) {throw SyntaxError('You must pass "Data"');return;}if ( typeof this._params.container === "undefined" || typeof this._params.container === null || this._params.container == "" ) {throw SyntaxError('You must pass "Container"');return;}this._params.elem = document.getElementById(this._params.container);if (this._params.elem == null) {throw SyntaxError( 'You must pass "Container" to generate tree, if you have passed the param check it existing in DOM or not.' );return;}AddRequiredLibs.call(this);}Lineage.prototype.load = function () {var _s = this._params.search;var jStr = JSON.stringify(this._params.data);_jData = JSON.parse(jStr);if (jStr.indexOf(".json") > -1) {$.getJSON(this._params.data, function (d) {this._data = d;_jData = d;}) .fail(function () {throw SyntaxError('Issue reading "Data"');}) .done(function () {GenerateTree(1);AddAutoComplete(_s, _jData);});}else {GenerateTree(1);AddAutoComplete(_s, _jData);}function AddAutoComplete(_s, _jData) {if (_s) {var items = [];$.each(_jData, function (key, val) {items[val.id] = val.name + " " + val.title;});autocomplete(_tb, items);}}};return Lineage;function AddRequiredLibs() {var myCSS = document.createElement("link");myCSS.href = _baseUrl + "lineage.min.css";myCSS.rel = "stylesheet";document.head.appendChild(myCSS);var faw = document.createElement("script");faw.src = "//kit.fontawesome.com/34af8a80dc.js";faw.crossorigin = "anonymous";document.head.appendChild(faw);_cont = document.createElement("div");_cont.setAttribute("class", "__container");_body = document.createElement("div");_body.setAttribute("class", "__lineage-body");_tree = document.createElement("div");_tree.setAttribute("id", "__lineage-tree");_tree.setAttribute("class", "__lineage-tree");_body.appendChild(_tree);_cont.appendChild(_body);if (this._params.search) {var _fixBar, _divSearch;_fixBar = document.createElement("div");_fixBar.setAttribute("id", "div__fixBar");_fixBar.setAttribute("class", "fixbar");_divSearch = document.createElement("div");_divSearch.setAttribute("id", "div__Search");_divSearch.setAttribute("class", "autocomplete");_tb = document.createElement("input");_tb.setAttribute("id", "input__Search");_tb.setAttribute("type", "text");_tb.setAttribute("placeholder", "Search");_fixBar.appendChild(_divSearch);_divSearch.appendChild(_tb);this._params.elem.appendChild(_fixBar);}this._params.elem.appendChild(_cont);}})();function GenerateTree(id) {if (id > 2) filterId = id;else filterId = "";var _tree = document.getElementById("__lineage-tree");_tree.innerHTML = "";$(".__container").hide();var filterdData = _jData.filter((c) => c.id == id);var ul = $("<ul/>").addClass("tree").appendTo(_tree);skipTheseMembers = [];$.each(filterdData, function (key, val) {if (jQuery.inArray(val.id, skipTheseMembers) == -1) {ul.append(Member.call(this, val));}htmlStr = "";});$(".__container") .delay(300) .fadeIn("slow", function () {var mid = Math.floor($(".__container").width() / 2);var extra = params.template == "raised" || params.template == "tilted" ? 1800 : 750;window.scroll({left: mid + extra, top: 0, behavior: "smooth" });$(".overlay").hide();});$("#input__Search").val("");var allH3 = $("h3");allH3.each(function () {var txt = this.innerHTML;if (txt.split(" ").length > 2) {const lastIndex = txt.lastIndexOf(" ");this.innerHTML = txt.substring(0, lastIndex) + "<br/>" + txt.substring(lastIndex + 1);}});}function Member(m) {var p = _jData.filter((i) => i.id == m.pid);if (p.length > 0) {skipTheseMembers.push(p[0].id);htmlStr += "<li class='pid'>" + CreateNode(m) + "<span class='connector'><i class='fa-solid fa-heart fa-lg'></i></span>" + CreateNode(p[0]);var c = _jData.filter((c) => c.mid == m.id || c.fid == m.id);if (c.length > 0) {$.each(c, function (k, v) {if (c[0].id == v.id) htmlStr += "<ul>";if (v.pid != undefined) Member(v);else htmlStr += "<li>" + CreateNode(v) + "</li>";if (c[c.length - 1].id == v.id) htmlStr += "</ul>";skipTheseMembers.push(v.id);});}}else htmlStr += "<li>" + CreateNode(m);+"</li>";return htmlStr;}function CreateNode(m) {var color = m.gender == "female" ? "#EA7B26" : "#4F9CE6";var shadow = m.gender == "female" ? "var(--pinkShadow)" : "var(--blueShadow)";shadow = params.shadow != null && params.shadow == 1 ? shadow : "";m.addr = m.addr.replace( "RIP", "<i class='fa-solid fa-hands-praying fa-2x orange'></i>" );if (m.cn != null || m.cn != "") m.addr += "<br/><img class='flag' src='https://flagcdn.com/20x15/" + m.cn + ".png'/>";var whichTemplate = params.template == null ? "circle" : params.template;var returnString = "";if (whichTemplate == "circle" || whichTemplate == "rounded") {returnString = Template1(whichTemplate);}if (whichTemplate == "tilted") {returnString = Template2();}if (whichTemplate == "raised") {returnString = Template3().replace("{shadow}", m.gender);}if (m.photo == "") {m.photo = m.gender == "male" ? "https://www.w3schools.com/howto/img_avatar.png" : "https://www.w3schools.com/howto/img_avatar2.png";}var mfid = _jData.filter((x) => x.id == m.id && x.mid != undefined);if ( mfid.length > 0 && filterId != "" && (m.id == filterId || m.pid == filterId) ) {returnString += '<i onclick="javascript:GenerateTree(' + mfid[0].mid + ');" class="' + topNodeIco + ' ihaveNodesAbove" style="cursor:pointer;"></i>';}return returnString .replace("{photo}", m.photo) .replace("{color}", color) .replace("{name}", m.name) .replace("{title}", m.title) .replace("{loc}", m.addr) .replace("{id}", m.id);}function Template1(shape) {var str = "";str += "<a href='javascript:GenerateTree({id});'>";str += " <div class='member-view-box'>";str += "<div class='member-image box " + shape + " ' style='box-shadow:{shadow}'>";str += " <img src='{photo}' alt='Member' style='box-shadow: 0em 0em 0 5px {color};' class='" + shape + " pic'>";str += " </div>";str += " </div>";str += " <div class='member-details'>";str += " <h3>{name}</h3>";str += " <h4>{title}</h4>";str += " <h5>{loc}</h5>";str += " </div>";str += "</a>";return str;}function Template2() {var str = "";str += "<a class='tilted-member' href='javascript:GenerateTree({id});'><div class='profile-card-4 text-center' style='border-color:{color}'>";str += " <div> <img src='{photo}' class='img img-responsive'></div>";str += " <div class='profile-content'>";str += " <div class='profile-description'>{name}";str += " <p>{title}</p>{loc}";str += " </div>";str += " </div>";str += "</div></a>";return str;}function Template3() {var str = "<a href='javascript:GenerateTree({id});'>";str += "<div class='m {shadow}'>";str += " <div class='m-img'>";str += " <img class='pic' src='{photo}' alt='m' />";str += "<h2>{name}</h2>";str += "<h3>{title}</h3>";str += "<h4>{loc}</h4>";str += "</div>";str += "</div>";str += "</a>";return str;}function autocomplete(inp, arr) {var currentFocus;inp.addEventListener("input", function (e) {var a, b, i, val = this.value;closeAllLists();if (!val) {return false;}currentFocus = -1;a = document.createElement("div");a.setAttribute("id", this.id + "autocomplete-list");a.setAttribute("class", "autocomplete-items");this.parentNode.appendChild(a);for (i = 1;i < arr.length;i++) {if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {b = document.createElement("div");var color = _jData[i - 1].gender == "female" ? "#EA7B26" : "#4F9CE6";b.innerHTML = "<img src='" + _jData[i - 1].photo + "' style='box-shadow: 0em 0em 0 2px " + color + ";'/>";b.innerHTML += "<span><strong style='color:tomato;font-weight:700;'>" + arr[i].substr(0, val.length) + "</strong>" + arr[i].substr(val.length) + "</span>";b.innerHTML += "<input type='hidden' value='" + i + "'><input type='hidden' value='" + arr[i] + "'>";b.addEventListener("click", function (e) {inp.value = this.getElementsByTagName("input")[1].value;GenerateTree(this.getElementsByTagName("input")[0].value);closeAllLists();});a.appendChild(b);}}});inp.addEventListener("keydown", function (e) {var x = document.getElementById(this.id + "autocomplete-list");if (x) x = x.getElementsByTagName("div");if (e.keyCode == 40) {currentFocus++;addActive(x);}else if (e.keyCode == 38) {currentFocus--;addActive(x);}else if (e.keyCode == 13) {e.preventDefault();if (currentFocus > -1) {if (x) x[currentFocus].click();}}});function addActive(x) {if (!x) return false;removeActive(x);if (currentFocus >= x.length) currentFocus = 0;if (currentFocus < 0) currentFocus = x.length - 1;x[currentFocus].classList.add("autocomplete-active");}function removeActive(x) {for (var i = 0;i < x.length;i++) {x[i].classList.remove("autocomplete-active");}}function closeAllLists(elmnt) {var x = document.getElementsByClassName("autocomplete-items");for (var i = 0;i < x.length;i++) {if (elmnt != x[i] && elmnt != inp) {x[i].parentNode.removeChild(x[i]);}}}document.addEventListener("click", function (e) {closeAllLists(e.target);});}